<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      color: #111;
      padding-bottom: 160px;
    }
    header {
      padding: 15px;
      text-align: center;
      font-weight: bold;
      border-bottom: 1px solid #eee;
    }
    .info-box {
      background: #fafafa;
      padding: 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      font-size: 15px;
      color: #333;
    }
    .form-field {
      display: none;
      background: #fff;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    .form-field label {
      display: block;
      font-size: 13px;
      margin-bottom: 5px;
      color: #555;
    }
    .form-field input {
      width: 90%;
      padding: 10px;
      font-size: 14px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .campo-duplo {
      display: flex;
      gap: 10px;
    }
    .campo-duplo div {
      flex: 1;
    }
    .product-card {
      display: flex;
      align-items: center;
      padding: 15px;
      border-bottom: 8px solid #f2f2f2;
    }
    .product-card img {
      width: 70px;
      height: 70px;
      border-radius: 4px;
      margin-right: 15px;
    }
    .product-info { flex: 1; }
    .product-info h4 {
      margin: 0;
      font-size: 14px;
      font-weight: normal;
      color: #333;
    }
    .product-info p {
      margin: 5px 0;
      font-size: 13px;
      color: #f53d5c;
      font-weight: bold;
    }
    .product-info small {
      text-decoration: line-through;
      color: #999;
      margin-left: 5px;
    }
    .qty-selector {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .qty-selector input {
      width: 50px;
      text-align: center;
      padding: 5px;
    }
    .section {
      padding: 15px;
      border-bottom: 8px solid #f2f2f2;
    }
    .section h3 { font-size: 15px; margin-bottom: 10px; }
    .price-summary, .total {
      font-size: 14px;
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
    }
    .total { font-size: 16px; font-weight: bold; margin-top: 10px; }
    .payment-method { padding: 15px; }
    .payment-option {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      font-size: 14px;
    }
    .payment-option img { width: 28px; margin-right: 10px; }
    .terms-box {
      padding: 15px;
      font-size: 12px;
      color: #555;
      line-height: 1.5;
      border-bottom: 8px solid #f2f2f2;
    }
    .summary-card {
      margin: 15px;
      padding: 16px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid #f0f0f0;
    }
    .summary-card .summary-line {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .summary-card .summary-line:last-child { margin-bottom: 0; }
    .summary-card .summary-icon {
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      line-height: 1;
    }
    .summary-icon-address {
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23111' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 10c0 6-9 12-9 12S3 16 3 10a9 9 0 1 1 18 0Z'/%3E%3Ccircle cx='12' cy='10' r='3'/%3E%3C/svg%3E") no-repeat center/contain;
      font-size: 0;
    }
    .summary-icon-id {
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23111' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='5' width='20' height='14' rx='2'/%3E%3Ccircle cx='8' cy='12' r='2.5'/%3E%3Cpath d='M13 10h6M13 14h6'/%3E%3C/svg%3E") no-repeat center/contain;
      font-size: 0;
    }
    .summary-card strong {
      display: block;
      font-size: 15px;
      color: #111;
    }
    .summary-card span { color: #555; }
    .summary-card .summary-address {
      font-size: 13px;
      color: #444;
      line-height: 1.4;
    }
    .checkout-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #eee;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .checkout-footer .footer-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
      font-weight: 600;
      color: #111;
    }
    .checkout-footer .footer-total .total-label {
      font-weight: 700;
    }
    .checkout-footer .footer-total .total-value {
      color: #f53d5c;
      font-weight: 700;
      font-size: 18px;
    }
    .checkout-button {
      width: 100%;
      background: #f53d5c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .checkout-button:hover { background: #e73151; }
    .checkout-button-subtext {
      font-size: 12px;
      font-weight: 400;
      margin-top: 6px;
      opacity: 0.9;
    }
    .checkout-button.is-loading {
      opacity: 0.7;
      cursor: not-allowed;
    }
    .checkout-button.is-loading .checkout-button-subtext {
      opacity: 0.7;
    }
    .hidden { display: none !important; }
    #pix-qrcode { text-align: center; margin: 0; }
    #pix-qrcode img { width: 220px; max-width: 220px; }
    .products-container {
      border-bottom: 8px solid #f2f2f2;
    }
  </style>
</head>
<body>

  <header>Resumo do pedido</header>

  <div id="customer-summary" class="summary-card hidden">
    <div class="summary-line">
      <span class="summary-icon summary-icon-address" aria-hidden="true"></span>
      <div>
        <strong id="summary-name">Cliente</strong>
        <span id="summary-phone">Telefone não informado</span>
        <div id="summary-address" class="summary-address"></div>
      </div>
    </div>
    <div class="summary-line">
      <span class="summary-icon summary-icon-id" aria-hidden="true"></span>
      <div>
        <span id="summary-cpf">CPF não informado</span>
      </div>
    </div>
  </div>

  <!-- Endereço -->
  <div class="info-box" id="address-box" onclick="toggleField('endereco-field')">+ Adicionar endereço de entrega</div>
  <div id="endereco-field" class="form-field">
    <label for="cep">CEP</label>
    <input type="text" id="cep" placeholder="00000-000" maxlength="9" onblur="consultarCep()">

    <label for="rua">Rua</label>
    <input type="text" id="rua" placeholder="Ex: Av. Paulista">

    <div class="campo-duplo">
      <div>
        <label for="numero">Número</label>
        <input type="text" id="numero" placeholder="123">
      </div>
      <div>
        <label for="complemento">Complemento</label>
        <input type="text" id="complemento" placeholder="Apto, Bloco...">
      </div>
    </div>

    <label for="bairro">Bairro</label>
    <input type="text" id="bairro" placeholder="Centro">

    <div class="campo-duplo">
      <div>
        <label for="cidade">Cidade</label>
        <input type="text" id="cidade" placeholder="São Paulo">
      </div>
      <div>
        <label for="estado">Estado</label>
        <input type="text" id="estado" maxlength="2" placeholder="SP">
      </div>
    </div>
  </div>

  <!-- CPF -->
  <div class="info-box" id="customer-box" onclick="toggleField('cpf-field')">+ Adicionar dados pessoais</div>
  <div id="cpf-field" class="form-field">
    <label for="nome">Nome completo</label>
    <input type="text" id="nome" placeholder="Seu nome completo">

    <label for="email">E-mail</label>
    <input type="email" id="email" placeholder="seu@email.com">

    <label for="telefone">Telefone</label>
    <input type="text" id="telefone" placeholder="11999999999">

    <label for="cpf">CPF</label>
    <input type="text" id="cpf" placeholder="000.000.000-00">
  </div>

  <!-- Container para produtos do carrinho -->
  <div id="products-container" class="products-container">
    <!-- Os produtos serão inseridos aqui via JavaScript -->
  </div>

  <!-- Resumo -->
  <div class="section">
    <h3>Resumo do pedido</h3>
    <div class="price-summary">
      <span>Subtotal</span> <span id="subtotal">R$ 0,00</span>
    </div>
    <div class="price-summary">
      <span>Frete</span> <span id="frete">Grátis</span>
    </div>
    <div class="total">
      <span>Total</span> <span id="total">R$ 0,00</span>
    </div>
  </div>

  <!-- Pagamento -->
  <div class="section payment-method">
    <h3>Forma de pagamento</h3>
    <div class="payment-option"><img src="pix.png" alt="Pix"> Pix</div>
  </div>

  <!-- Termos -->
  <div class="terms-box">
    Ao fazer um pedido, você concorda com <b>Termos de uso e venda do TikTok Shop</b> e reconhece que leu e concordou com a <b>Política de privacidade do TikTok</b>.
  </div>

  <!-- Rodapé -->
  <div class="checkout-footer">
    <div class="footer-total">
      <span id="footer-total-label" class="total-label">Total (0 item)</span>
      <span id="footer-total" class="total-value">R$ 0,00</span>
    </div>
    <button id="checkout-btn" class="checkout-button">
      <span class="checkout-button-text">Fazer pedido</span>
      <span class="checkout-button-subtext">O cupom expira em <span id="checkout-countdown">00:05:00</span> | Frete grátis</span>
    </button>
  </div>

  <!-- Modal PIX -->
  <div id="pix-modal" class="pix-modal" hidden>
    <div class="pix-modal-backdrop" onclick="fecharPixModal()" aria-hidden="true"></div>
    <div class="pix-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="pix-modal-title" tabindex="-1">
      <div id="pix-sheet" class="pix-sheet">
        <div class="pix-sheet-drag-handle" aria-hidden="true"></div>
        <div class="pix-sheet-header">
          <div class="pix-sheet-status">
            <span id="pix-status" class="pix-sheet-status-title">Aguardando pagamento</span>
            <span id="pix-sheet-value" class="pix-sheet-value">R$ 0,00</span>
          </div>
          <div class="pix-sheet-expiration">
            <span class="pix-sheet-exp-label">Vence em:</span>
            <span id="pix-expiration-timer" class="pix-expiration-timer">00:10:00</span>
          </div>
        </div>

        <div class="pix-sheet-body">
          <div class="pix-sheet-instructions">
            <h3>Escaneie o QR code</h3>
            <p>Use o app do seu banco para ler o código ou copie o código PIX abaixo.</p>
          </div>

          <div class="pix-qrcode-container">
            <div id="pix-qrcode" class="pix-qrcode"></div>
          </div>

          <div class="pix-codigo-container">
            <div class="pix-label">Código PIX (copia e cola)</div>
            <div class="pix-input-group">
              <input type="text" id="pix-codigo" class="pix-codigo-input" readonly>
              <button id="pix-copiar" class="pix-copiar-btn" onclick="copiarCodigoPix()">Copiar PIX</button>
            </div>
          </div>
        </div>

        <button type="button" class="pix-sheet-close" onclick="fecharPixModal()">Fechar</button>
      </div>
    </div>
  </div>

<script>
  // ===== SISTEMA DE CARRINHO =====
  function getCart() {
    try {
      const cart = localStorage.getItem('tiktokShopCart');
      return cart ? JSON.parse(cart) : [];
    } catch (error) {
      console.error('Erro ao carregar carrinho:', error);
      return [];
    }
  }

  function formatPrice(price) {
    const numeric = Number(price) || 0;
    return 'R$ ' + numeric.toFixed(2).replace('.', ',');
  }

  const CUSTOMER_INFO_KEY = 'tiktokCheckoutInfo';

  function getStoredCustomerInfo() {
    try {
      const data = localStorage.getItem(CUSTOMER_INFO_KEY);
      return data ? JSON.parse(data) : {};
    } catch (error) {
      console.warn('Não foi possível carregar dados do cliente salvos', error);
      return {};
    }
  }

  function saveCustomerInfo(info) {
    try {
      localStorage.setItem(CUSTOMER_INFO_KEY, JSON.stringify(info));
    } catch (error) {
      console.warn('Não foi possível salvar dados do cliente', error);
    }
  }

  function updateStoredCustomerInfo(partial) {
    const current = getStoredCustomerInfo();
    const next = { ...current, ...partial };
    saveCustomerInfo(next);
    renderCustomerSummary(next);
    updateInfoBoxesLabels(next);
  }

  function collectCustomerFormData() {
    return {
      nome: document.getElementById('nome').value.trim(),
      email: document.getElementById('email').value.trim(),
      telefone: document.getElementById('telefone').value.trim(),
      cpf: document.getElementById('cpf').value.trim(),
      rua: document.getElementById('rua').value.trim(),
      numero: document.getElementById('numero').value.trim(),
      complemento: document.getElementById('complemento').value.trim(),
      bairro: document.getElementById('bairro').value.trim(),
      cidade: document.getElementById('cidade').value.trim(),
      estado: document.getElementById('estado').value.trim(),
      cep: document.getElementById('cep').value.trim()
    };
  }

  function persistCurrentCustomerInfo() {
    updateStoredCustomerInfo(collectCustomerFormData());
  }

  function maskPhone(phone) {
    const digits = (phone || '').replace(/\D/g, '');
    if (!digits) return '';
    const country = '+55';
    const lastEleven = digits.slice(-11);
    if (lastEleven.length < 10) return phone;
    const ddd = lastEleven.slice(0, 2);
    const numberBody = lastEleven.slice(2, -2);
    const suffix = lastEleven.slice(-2);
    const maskedBody = numberBody.replace(/./g, '*');
    return `(${country})${ddd}${maskedBody}${suffix}`;
  }

  function formatCPF(cpf) {
    const digits = (cpf || '').replace(/\D/g, '');
    if (digits.length !== 11) return cpf || '';
    return `${digits.slice(0, 3)}.${digits.slice(3, 6)}.${digits.slice(6, 9)}-${digits.slice(9)}`;
  }

  function buildAddressString(info) {
    const parts = [];
    if (info.rua) {
      let linha = info.rua;
      if (info.numero) {
        linha += `, ${info.numero}`;
        if (info.complemento) {
          linha += ` - ${info.complemento}`;
        }
      }
      parts.push(linha);
    }
    const bairroCidade = [info.bairro, info.cidade].filter(Boolean).join(', ');
    if (bairroCidade) {
      let cidadeLinha = bairroCidade;
      if (info.estado) {
        cidadeLinha += ` - ${info.estado.toUpperCase()}`;
      }
      parts.push(cidadeLinha);
    } else if (info.estado) {
      parts.push(info.estado.toUpperCase());
    }
    if (info.cep) {
      parts.push(`CEP: ${info.cep}`);
    }
    return parts.join(' • ');
  }

  function isAddressComplete(info) {
    return info.rua && info.numero && info.bairro && info.cidade && info.estado && info.cep;
  }

  function isCustomerComplete(info) {
    return info.nome && info.telefone && info.cpf;
  }

  function renderCustomerSummary(info) {
    const summaryCard = document.getElementById('customer-summary');
    if (!summaryCard) return;
    const hasData = isCustomerComplete(info) && isAddressComplete(info);
    summaryCard.classList.toggle('hidden', !hasData);

    document.getElementById('summary-name').textContent = info.nome || 'Cliente';

    const phoneEl = document.getElementById('summary-phone');
    phoneEl.textContent = info.telefone ? maskPhone(info.telefone) : 'Telefone não informado';

    const addressEl = document.getElementById('summary-address');
    const addressText = buildAddressString(info);
    addressEl.textContent = addressText || 'Endereço não informado';

    const cpfEl = document.getElementById('summary-cpf');
    cpfEl.textContent = info.cpf ? `CPF: ${formatCPF(info.cpf)}` : 'CPF não informado';
  }

  function updateInfoBoxesLabels(info) {
    const addressBox = document.getElementById('address-box');
    const customerBox = document.getElementById('customer-box');
    if (addressBox) {
      addressBox.textContent = isAddressComplete(info) ? 'Editar endereço de entrega' : '+ Adicionar endereço de entrega';
    }
    if (customerBox) {
      customerBox.textContent = isCustomerComplete(info) ? 'Editar dados pessoais' : '+ Adicionar dados pessoais';
    }
  }

  function hydrateCustomerForm(info) {
    const mappings = ['nome','email','telefone','cpf','rua','numero','complemento','bairro','cidade','estado','cep'];
    mappings.forEach((field) => {
      const el = document.getElementById(field);
      if (el && info[field]) {
        el.value = info[field];
      }
    });
  }

  function initCustomerInfo() {
    const stored = getStoredCustomerInfo();
    hydrateCustomerForm(stored);
    renderCustomerSummary(stored);
    updateInfoBoxesLabels(stored);

    const fieldMap = {
      nome: 'nome',
      email: 'email',
      telefone: 'telefone',
      cpf: 'cpf',
      rua: 'rua',
      numero: 'numero',
      complemento: 'complemento',
      bairro: 'bairro',
      cidade: 'cidade',
      estado: 'estado',
      cep: 'cep'
    };

    Object.keys(fieldMap).forEach((id) => {
      const el = document.getElementById(id);
      if (!el) return;
      const handler = () => {
        updateStoredCustomerInfo({ [fieldMap[id]]: el.value.trim() });
      };
      el.addEventListener('blur', handler);
      el.addEventListener('input', handler);
    });
  }

  let countdownInterval = null;
  const COUNTDOWN_DURATION = 5 * 60; // 5 minutos

  function formatCountdown(seconds) {
    const safeSeconds = Math.max(seconds, 0);
    const h = Math.floor(safeSeconds / 3600).toString().padStart(2, '0');
    const m = Math.floor((safeSeconds % 3600) / 60).toString().padStart(2, '0');
    const s = Math.floor(safeSeconds % 60).toString().padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function startCheckoutCountdown() {
    const countdownEl = document.getElementById('checkout-countdown');
    if (!countdownEl) return;
    let remaining = COUNTDOWN_DURATION;
    countdownEl.textContent = formatCountdown(remaining);
    if (countdownInterval) {
      clearInterval(countdownInterval);
    }
    countdownInterval = setInterval(() => {
      remaining -= 1;
      if (remaining < 0) {
        remaining = COUNTDOWN_DURATION;
      }
      const formatted = formatCountdown(remaining);
      countdownEl.textContent = formatted;
    }, 1000);
  }

  const PIX_COUNTDOWN_SECONDS = 10 * 60;
  let pixCountdownInterval = null;
  let pixCountdownRemaining = PIX_COUNTDOWN_SECONDS;

  function formatPixCountdown(seconds) {
    const safe = Math.max(seconds, 0);
    const h = Math.floor(safe / 3600).toString().padStart(2, '0');
    const m = Math.floor((safe % 3600) / 60).toString().padStart(2, '0');
    const s = Math.floor(safe % 60).toString().padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function atualizarPixCountdownDisplay() {
    const timerEl = document.getElementById('pix-expiration-timer');
    if (timerEl) {
      timerEl.textContent = formatPixCountdown(pixCountdownRemaining);
    }
  }

  function marcarPixComoExpirado() {
    const statusEl = document.getElementById('pix-status');
    if (statusEl) {
      statusEl.textContent = 'Tempo expirado. Gere um novo PIX.';
      statusEl.classList.remove('is-success');
      statusEl.classList.add('is-warning');
    }
    const timerEl = document.getElementById('pix-expiration-timer');
    if (timerEl) {
      timerEl.textContent = formatPixCountdown(0);
    }
    mostrarNotificacao('O tempo do PIX expirou. Gere um novo pagamento.', 'error');
  }

  function pararPixCountdown() {
    if (pixCountdownInterval) {
      clearInterval(pixCountdownInterval);
      pixCountdownInterval = null;
    }
  }

  function iniciarPixCountdown() {
    pararPixCountdown();
    pixCountdownRemaining = PIX_COUNTDOWN_SECONDS;
    atualizarPixCountdownDisplay();

    pixCountdownInterval = setInterval(() => {
      pixCountdownRemaining -= 1;
      atualizarPixCountdownDisplay();
      if (pixCountdownRemaining <= 0) {
        pararPixCountdown();
        marcarPixComoExpirado();
      }
    }, 1000);
  }

  function normalizeQuantity(item) {
    const value = Number(item?.quantity ?? item?.qty ?? 1);
    if (!Number.isFinite(value) || value <= 0) return 1;
    return Math.floor(value);
  }

  function calculateTotals(cart) {
    let subtotal = 0;
    let totalItems = 0;
    let totalDiscount = 0;

    cart.forEach(item => {
      const quantity = normalizeQuantity(item);
      subtotal += item.price * quantity;
      totalItems += quantity;
      // Simula um desconto de 30% para cada produto
      const originalPrice = item.price / 0.7; // Preço original assumindo 30% de desconto
      totalDiscount += (originalPrice * quantity) - (item.price * quantity);
    });

    return {
      subtotal,
      total: subtotal,
      totalDiscount,
      totalItems
    };
  }

  function renderCartProducts(cart) {
    const container = document.getElementById('products-container');
    
    if (cart.length === 0) {
        container.innerHTML = `
            <div class="product-card">
                <div class="product-info">
                    <h4>Seu carrinho está vazio</h4>
                    <p>Adicione produtos ao carrinho primeiro</p>
                </div>
            </div>
        `;
        return;
    }

    let html = '';
    cart.forEach((item, index) => {
        // Preço original simulado (30% mais caro)
        const originalPrice = (item.price / 0.7).toFixed(2);
        const quantity = normalizeQuantity(item);
        const displayName = item.name || item.title || 'Produto';
        
        // CORREÇÃO DOS CAMINHOS DE IMAGEM
        let imagePath = item.image;
        
        // Se a imagem não começa com http (é local)
        if (!imagePath.startsWith('http')) {
            // Remove qualquer ../ ou ./ do início
            imagePath = imagePath.replace(/^(\.\.\/|\.\/)/, '');
            // Adiciona ../ para voltar uma pasta (já que checkout está em subpasta)
            if (!imagePath.startsWith('../')) {
                imagePath = '../' + imagePath;
            }
        }
        
        html += `
            <div class="product-card">
                <img src="${imagePath}" alt="${displayName}" onerror="this.onerror=null;this.src='../images/ndaq.png'">
                <div class="product-info">
                    <h4>${displayName}</h4>
                    <p>${formatPrice(item.price)} <small>${formatPrice(parseFloat(originalPrice))}</small></p>
                    <div class="qty-selector">
                        <label>Qtd:</label>
                        <input type="number" value="${quantity}" min="1" readonly>
                    </div>
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

  function updateOrderSummary(cart) {
    if (cart.length === 0) {
      document.getElementById('subtotal').textContent = 'R$ 0,00';
      document.getElementById('total').textContent = 'R$ 0,00';
      document.getElementById('footer-total').textContent = 'R$ 0,00';
      document.getElementById('footer-total-label').textContent = 'Total (0 item)';
      return;
    }

    const totals = calculateTotals(cart);

    document.getElementById('subtotal').textContent = formatPrice(totals.subtotal);
    document.getElementById('total').textContent = formatPrice(totals.total);
    document.getElementById('footer-total').textContent = formatPrice(totals.total);
    const label = totals.totalItems === 1 ? 'Total (1 item)' : `Total (${totals.totalItems} itens)`;
    document.getElementById('footer-total-label').textContent = label;
  }

  function loadCheckout() {
    const cart = getCart();
    console.log('Carrinho no checkout:', cart);
    
    renderCartProducts(cart);
    updateOrderSummary(cart);
  }

  const API_BASE_OVERRIDE = (window.CHECKOUT_API_BASE_URL || document.body?.dataset?.apiBase || '').trim();

  function buildApiUrl(path) {
    const sanitizedPath = `${path}`.replace(/^\/+/, '');

    if (API_BASE_OVERRIDE) {
      try {
        const normalizedBase = API_BASE_OVERRIDE.endsWith('/') ? API_BASE_OVERRIDE : API_BASE_OVERRIDE + '/';
        return new URL(sanitizedPath, normalizedBase).toString();
      } catch (err) {
        console.warn('API base override inválida:', API_BASE_OVERRIDE, err);
      }
    }
    
    const currentOrigin = window.location.origin;
    const currentPath = window.location.pathname;
    const isFileProtocol = !currentOrigin || currentOrigin === 'null' || currentOrigin.startsWith('file:');
    const inCheckoutDir = currentPath?.includes('/checkout/');
    
    if (isFileProtocol) {
      const relativeUrl = `${inCheckoutDir ? '' : 'checkout/'}${sanitizedPath}`;
      console.log(`🔗 API URL (Arquivo local): ${relativeUrl}`);
      return relativeUrl;
    }
    
    console.log(`🔍 Detectando API URL:
      Origin: ${currentOrigin}
      Path: ${currentPath}
      Target: ${sanitizedPath}
    `);
    
    if (currentOrigin.includes('127.0.0.1:5500') || currentOrigin.includes('localhost:5500')) {
      const apiUrl = `${currentOrigin}/checkout/${sanitizedPath}`;
      console.log(`🔗 API URL (Local): ${apiUrl}`);
      return apiUrl;
    }
    
    if (currentOrigin.includes('vercel.app') || currentOrigin.includes('tikt-ten.vercel.app')) {
      const apiUrl = `${currentOrigin}/api/${sanitizedPath}`;
      console.log(`🔗 API URL (Vercel): ${apiUrl}`);
      return apiUrl;
    }
    
    const apiUrl = currentPath.includes('/checkout/') 
      ? `${currentOrigin}${currentPath.replace(/\/[^/]*$/, '')}/${sanitizedPath}`
      : `${currentOrigin}/checkout/${sanitizedPath}`;
    
    console.log(`🔗 API URL (Fallback): ${apiUrl}`);
    return apiUrl;
  }

  async function tryApiRequest(path, options = {}) {
    const sanitizedPath = `${path}`.replace(/^\/+/, '');
    const urls = [];
    const currentOrigin = window.location.origin;
    const currentPath = window.location.pathname || '';
    const isFileProtocol = !currentOrigin || currentOrigin === 'null' || currentOrigin.startsWith('file:');
    const inCheckoutDir = currentPath.includes('/checkout/');

    const pushUrl = (candidate) => {
      if (!candidate || urls.includes(candidate)) {
        return;
      }
      urls.push(candidate);
    };

    pushUrl(buildApiUrl(sanitizedPath));
    if (inCheckoutDir) {
      pushUrl(sanitizedPath);
      pushUrl(`./${sanitizedPath}`);
    } else {
      pushUrl(`checkout/${sanitizedPath}`);
      pushUrl(`./checkout/${sanitizedPath}`);
    }

    if (!isFileProtocol) {
      pushUrl(`${currentOrigin}/api/${sanitizedPath}`);
      pushUrl(`${currentOrigin}/checkout/${sanitizedPath}`);
      pushUrl(`${currentOrigin}/${sanitizedPath}`);
    }

    let lastError = null;
    let lastResponse = null;

    for (const url of urls) {
      try {
        console.log(`🔄 Tentando API URL: ${url}`);
        const response = await fetch(url, options);

        if (response.ok) {
          console.log(`✅ API URL funcionou: ${url}`);
          return response;
        }

        console.warn(`⚠️ API URL retornou ${response.status}: ${url}`);
        lastResponse = response;
        lastError = new Error(`HTTP ${response.status}`);
      } catch (error) {
        console.warn(`❌ Erro na API URL ${url}:`, error.message);
        lastError = error;
      }
    }

    if (lastResponse) {
      return lastResponse;
    }

    throw lastError || new Error('Todas as rotas da API falharam');
  }

  // ===== FUNÇÕES ORIGINAIS DO CHECKOUT =====
  function toggleField(id) {
    const el = document.getElementById(id);
    el.style.display = el.style.display === "block" ? "none" : "block";
  }

  // Função para consultar CEP e preencher endereço
  function consultarCep() {
    const cepInput = document.getElementById('cep');
    const cep = cepInput.value.replace(/\D/g, '');

    // Validação: CEP deve ter exatamente 8 dígitos
    if (!/^\d{8}$/.test(cep)) {
      return;
    }

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(response => {
        if (!response.ok) throw new Error('CEP inválido!');
        return response.json();
      })
      .then(data => {
        if (data.erro) {
          alert('CEP não encontrado!');
          return;
        }
        document.getElementById('rua').value = data.logradouro || '';
        document.getElementById('bairro').value = data.bairro || '';
        document.getElementById('cidade').value = data.localidade || '';
        document.getElementById('estado').value = data.uf || '';
        document.getElementById('numero').focus();
        persistCurrentCustomerInfo();
      })
      .catch(() => alert('Erro ao consultar CEP!'));
  }

  // Dispara consulta ao terminar de digitar 8 dígitos no CEP
  document.getElementById('cep').addEventListener('input', function(e) {
    const valor = e.target.value.replace(/\D/g, '');
    if (valor.length === 8) {
      consultarCep();
    }
  });

  document.getElementById("checkout-btn").addEventListener("click", async () => {
    const cart = getCart();
    if (cart.length === 0) {
      alert("Seu carrinho está vazio! Adicione produtos primeiro.");
      return;
    }

    const nome = document.getElementById("nome").value;
    const email = document.getElementById("email").value;
    const telefone = document.getElementById("telefone").value;
    const cpf = document.getElementById("cpf").value;

    // Endereço separado
    const rua = document.getElementById("rua").value;
    const numero = document.getElementById("numero").value;
    const complemento = document.getElementById("complemento").value;
    const bairro = document.getElementById("bairro").value;
    const cidade = document.getElementById("cidade").value;
    const estado = document.getElementById("estado").value;
    const cep = document.getElementById("cep").value;

    const totals = calculateTotals(cart);
    const amountValue = Number(totals.total.toFixed(2));
    const amountFormatted = amountValue.toFixed(2);

    if (!nome || !email || !telefone || !cpf || !rua || !numero || !bairro || !cidade || !estado || !cep) {
      alert("Preencha todos os campos obrigatórios!");
      return;
    }

    // Montar lista de produtos para enviar à API
    const produtos = cart.map(item => ({
      id: item.id || item.sku || null,
      nome: item.name || item.title || 'Produto',
      preco: Number(item.price),
      quantidade: normalizeQuantity(item),
      image: item.image || null
    }));

    try {
      // Mudar estado do botão para loading
      const botaoCheckout = document.getElementById('checkout-btn');
      const estadoOriginal = botaoCheckout.innerHTML;
      
      botaoCheckout.innerHTML = `
        <span style="display: flex; align-items: center; justify-content: center;">
          <svg style="animation: spin 1s linear infinite; margin-right: 8px;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"/>
          </svg>
          Gerando PIX, aguarde...
        </span>
        <span class="checkout-button-subtext">Processando pagamento...</span>
      `;
      botaoCheckout.disabled = true;
      botaoCheckout.style.opacity = '0.7';
      botaoCheckout.style.cursor = 'not-allowed';
      
      persistCurrentCustomerInfo();
      const requestPayload = {
        debtor_name: nome,
        email: email,
        debtor_document_number: cpf,
        phone: telefone,
        amount: amountValue,
        produtos: produtos,
        address_street: rua,
        address_number: numero,
        address_complement: complemento,
        address_neighborhood: bairro,
        address_city: cidade,
        address_state: estado,
        address_zipcode: cep,
        payment_method: "pix"
      };
      const requestOptions = {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(requestPayload)
      };
      
      console.log("🚀 Iniciando requisição para API TriboPay...");
      const response = await tryApiRequest("api.js", requestOptions);
      const resolvedEndpoint = response.url || buildApiUrl("api.js");
      console.log("Endpoint TriboPay API:", resolvedEndpoint);

      const contentType = response.headers.get("content-type") || "";
      const rawBody = await response.text();
      
      console.log(`🔍 Debug API Response:
        Status: ${response.status}
        Content-Type: ${contentType}
        Raw Body Length: ${rawBody?.length || 0}
        Raw Body Preview: ${rawBody?.substring(0, 200)}...
        URL: ${resolvedEndpoint}
      `);

      let data = null;

      if (!rawBody || rawBody.length === 0) {
        console.error("❌ Servidor não retornou nenhum dado");
        if (response.status === 0) {
          throw new Error("Erro de conexão: Verifique sua internet ou se o servidor está ativo.");
        } else if (response.status === 405) {
          throw new Error("Erro 405: API não aceita POST. Verifique se o endpoint api.js está funcionando.");
        } else if (response.status === 404) {
          throw new Error("Erro 404: Endpoint api.js não encontrado no servidor.");
        } else if (response.status >= 500) {
          throw new Error(`Erro do servidor (${response.status}): Tente novamente em alguns minutos.`);
        } else {
          throw new Error(`Gateway não retornou dados (Status: ${response.status}).`);
        }
      }

      if (contentType.includes("application/json") || rawBody.trim().startsWith('{')) {
        try {
          data = JSON.parse(rawBody);
        } catch (parseErr) {
          console.error("❌ Falha ao converter resposta em JSON:", parseErr);
          console.error("Raw response:", rawBody);
          throw new Error("Resposta do servidor não é um JSON válido.");
        }
      } else {
        console.warn("⚠️ Resposta não é JSON:", contentType);
        console.warn("Raw response:", rawBody);
        throw new Error(`Servidor retornou tipo inesperado: ${contentType || "desconhecido"}`);
      }

      console.log("Resposta TriboPay:", data);

      if (!response.ok || data.error) {
        let message = data.message || `Erro ao criar transação (HTTP ${response.status}).`;
        
        // Tratamento especial para erro de valor mínimo
        if (message.includes('valor da compra precisa ser no minimo 5 reais') || message.includes('Valor mínimo')) {
          message = `❌ Valor mínimo para PIX é R$ 5,00. Adicione mais produtos ao carrinho.`;
        }
        
        console.error('Erro detalhado da API:', data);
        throw new Error(message);
      }

      // Extrair dados do PIX da resposta TriboPay
      const qrCodeImage = data.pix?.qr_code_base64 || data.qr_code_image_url || data.qrcode_image_url || null;
      const pixPayload = data.pix?.pix_qr_code || data.pix?.pix_url || data.pix_copy_paste || data.qrcode || null;

      if (qrCodeImage || pixPayload) {
        const transactionHash = data.hash || `${Date.now()}`;
        
        // Exibir PIX inline na página
        exibirPixInline({
          transacao: transactionHash,
          nome: nome,
          email: email,
          telefone: telefone,
          hash: transactionHash,
          pix: pixPayload || '',
          qrcode: qrCodeImage || '',
          valor: amountFormatted.replace(".", ","),
          produtos: produtos,
          dadosCompletos: data
        });
        
        // Iniciar verificação de pagamento
        iniciarVerificacaoPagamento(transactionHash, {
          nome, email, telefone, 
          valor: amountFormatted.replace(".", ","),
          produtos: JSON.stringify(produtos)
        });
        
      } else {
        throw new Error(data.message || 'Não foi possível obter os dados do PIX.');
      }
    } catch (err) {
      // Restaurar estado original do botão
      const botaoCheckout = document.getElementById('checkout-btn');
      botaoCheckout.innerHTML = estadoOriginal;
      botaoCheckout.disabled = false;
      botaoCheckout.style.opacity = '';
      botaoCheckout.style.cursor = '';
      
      alert("Erro na comunicação com o servidor: " + err.message);
    }
  });

  // Carregar o checkout quando a página abrir
  document.addEventListener('DOMContentLoaded', () => {
    initCustomerInfo();
    startCheckoutCountdown();
    loadCheckout();
  });

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && document.body.classList.contains('pix-modal-open')) {
      fecharPixModal();
    }
  });

  // ===== FUNÇÕES DO PIX INLINE =====
  function exibirPixInline(dados) {
    console.log('Exibindo PIX inline com dados:', dados);
    
    const pixModal = document.getElementById('pix-modal');
    const statusEl = document.getElementById('pix-status');
    const valueEl = document.getElementById('pix-sheet-value');
    
    if (statusEl) {
      statusEl.textContent = 'Aguardando pagamento';
      statusEl.classList.remove('is-success', 'is-warning');
    }
    if (valueEl) {
      valueEl.textContent = `R$ ${dados.valor || '0,00'}`;
    }
    
    // QR Code - verificar diferentes formatos possíveis
    const qrContainer = document.getElementById('pix-qrcode');
    let qrCodeHtml = '';
    
    // Primeiro, tentar usar QR code base64 se disponível
    if (dados.qrcode && dados.qrcode.startsWith('data:image')) {
      qrCodeHtml = `<img src="${dados.qrcode}" alt="QR Code PIX" style="max-width: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">`;
    }
    // Senão, tentar gerar QR code a partir do código PIX
    else if (dados.pix && dados.pix.length > 10) {
      qrCodeHtml = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(dados.pix)}" alt="QR Code PIX" style="max-width: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" onload="console.log('QR Code carregado com sucesso')" onerror="console.error('Erro ao carregar QR Code'); this.style.display='none'; this.parentNode.innerHTML += '<p style=\\'color:#f53d5c; font-weight:bold;\\'>Use o código copia e cola abaixo</p>';">`;
    }
    // Caso contrário, mostrar mensagem
    else {
      qrCodeHtml = '<div style="padding: 20px; text-align: center; color: #f53d5c; font-weight: bold;"><p>🔄 Gerando QR Code...</p><p style="font-size: 0.9em; color: #666;">Use o código copia e cola abaixo</p></div>';
    }
    
    qrContainer.innerHTML = qrCodeHtml;
    
    // Código PIX
    const pixInput = document.getElementById('pix-codigo');
    const pixCopiarBtn = document.getElementById('pix-copiar');
    
    if (dados.pix && dados.pix.length > 10) {
      pixInput.value = dados.pix;
      pixInput.style.display = 'block';
      pixCopiarBtn.style.display = 'inline-block';
      console.log('Código PIX definido:', dados.pix.substring(0, 50) + '...');
    } else {
      pixInput.value = 'Código PIX não disponível';
      pixInput.style.display = 'block';
      pixCopiarBtn.style.display = 'none';
      console.warn('Código PIX não encontrado nos dados');
    }

    iniciarPixCountdown();

    if (pixModal) {
      pixModal.removeAttribute('hidden');
      pixModal.classList.add('open');
      document.body.classList.add('pix-modal-open');
      
      // Focar botão de copiar para acessibilidade
      const dialog = pixModal.querySelector('.pix-modal-dialog');
      dialog?.focus();
    } else {
      console.warn('Modal PIX não encontrado.');
    }
    
    console.log('PIX inline exibido com sucesso');
  }

  function fecharPixModal() {
    const pixModal = document.getElementById('pix-modal');
    if (pixModal) {
      pixModal.classList.remove('open');
      pixModal.setAttribute('hidden', '');
    }
    pararPixCountdown();
    document.body.classList.remove('pix-modal-open');
    document.getElementById('checkout-btn')?.focus();
  }

  async function copiarCodigoPix() {
    const input = document.getElementById('pix-codigo');
    const botao = document.getElementById('pix-copiar');
    
    try {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(input.value);
      } else {
        input.select();
        input.setSelectionRange(0, 99999);
        document.execCommand("copy");
      }
      
      const textoOriginal = botao.textContent;
      botao.textContent = "✅ Copiado!";
      botao.style.background = "#28a745";
      
      setTimeout(() => {
        botao.textContent = textoOriginal;
        botao.style.background = "";
      }, 2000);
      
      mostrarNotificacao("Código PIX copiado com sucesso!", "success");
      
    } catch (err) {
      mostrarNotificacao("Erro ao copiar. Selecione o texto manualmente.", "error");
    }
  }

  function mostrarNotificacao(mensagem, tipo) {
    const notificacao = document.createElement('div');
    notificacao.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      z-index: 10001;
      animation: slideIn 0.3s ease-out;
      ${tipo === 'success' ? 'background: #28a745;' : 'background: #dc3545;'}
    `;
    notificacao.textContent = mensagem;
    
    document.body.appendChild(notificacao);
    
    setTimeout(() => {
      notificacao.remove();
    }, 3000);
  }

  function iniciarVerificacaoPagamento(transacaoId, dadosCliente) {
    let tentativas = 0;
    const maxTentativas = 120; // 10 minutos (5s * 120 = 600s)
    
    const verificar = setInterval(async () => {
      tentativas++;
      
      try {
        const verificaUrl = buildApiUrl(`verifica.js?id=${encodeURIComponent(transacaoId)}`);
        const response = await fetch(verificaUrl);
        const data = await response.json();
        
        console.log(`Verificação ${tentativas}:`, data);
        
        if (data.status === "pago" || data.success === true) {
          clearInterval(verificar);
          pararPixCountdown();
          
          const statusEl = document.getElementById('pix-status');
          if (statusEl) {
            statusEl.textContent = 'Pagamento confirmado!';
            statusEl.classList.remove('is-warning');
            statusEl.classList.add('is-success');
          }
          const timerEl = document.getElementById('pix-expiration-timer');
          if (timerEl) timerEl.textContent = formatPixCountdown(0);
          
          // Mostrar notificação de sucesso
          mostrarNotificacao("Pagamento confirmado! Redirecionando...", "success");
          
          // Aguardar 3 segundos e redirecionar
          setTimeout(() => {
            // Redirecionar para página de sucesso
            const params = new URLSearchParams({
              transacao: transacaoId,
              ...dadosCliente
            });
            window.location.href = `pagamento.js?${params.toString()}`;
          }, 3000);
          
        } else if (tentativas >= maxTentativas) {
          clearInterval(verificar);
          pararPixCountdown();
          const statusEl = document.getElementById('pix-status');
          if (statusEl) {
            statusEl.textContent = 'Tempo limite atingido. Gere um novo PIX.';
            statusEl.classList.remove('is-success');
            statusEl.classList.add('is-warning');
          }
        }
        
      } catch (error) {
        console.error('Erro na verificação:', error);
        if (tentativas >= maxTentativas) {
          clearInterval(verificar);
        }
      }
    }, 5000); // Verificar a cada 5 segundos
  }

</script>

<!-- CSS para animação de rotação -->
<style>
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
</style>

<style>
  /* CSS para modal PIX */
  body.pix-modal-open {
    overflow: hidden;
  }
  .pix-modal {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: flex-end;
    padding: 24px 16px;
    z-index: 1000;
  }
  .pix-modal.open {
    display: flex;
  }
  .pix-modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(15, 23, 42, 0.65);
  }
  .pix-modal-dialog {
    position: relative;
    z-index: 1;
    width: min(460px, 100%);
    margin-bottom: max(env(safe-area-inset-bottom), 16px);
  }
  .pix-sheet {
    background: #ffffff;
    border-radius: 28px;
    box-shadow: 0 32px 48px rgba(15, 23, 42, 0.25);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  .pix-sheet-drag-handle {
    width: 56px;
    height: 5px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.15);
    margin: 14px auto 4px;
  }
  .pix-sheet-header {
    padding: 12px 24px 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .pix-sheet-status {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .pix-sheet-status-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: #0f172a;
  }
  .pix-sheet-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #ef3e64;
  }
  .pix-sheet-expiration {
    background: rgba(239, 62, 100, 0.08);
    color: #ef3e64;
    border-radius: 999px;
    padding: 8px 18px;
    font-size: 0.9rem;
    font-weight: 600;
    align-self: center;
    display: inline-flex;
    gap: 6px;
    align-items: center;
  }
  .pix-sheet-body {
    padding: 16px 24px 24px;
  }
  .pix-sheet-instructions {
    text-align: center;
    margin-bottom: 20px;
  }
  .pix-sheet-instructions h3 {
    margin: 12px 0 6px;
    font-size: 1.1rem;
    font-weight: 600;
    color: #0f172a;
  }
  .pix-sheet-instructions p {
    margin: 0;
    color: #475569;
    font-size: 0.95rem;
  }
  .pix-sheet-exp-label {
    opacity: 0.8;
  }
  .pix-expiration-timer {
    font-variant-numeric: tabular-nums;
  }
  .pix-sheet-status-title.is-success {
    color: #16a34a;
  }
  .pix-sheet-status-title.is-warning {
    color: #b45309;
  }
  .pix-sheet-close {
    border: none;
    border-radius: 0;
    background: #ef3e64;
    color: white;
    font-size: 1rem;
    font-weight: 600;
    padding: 16px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.2);
  }
  .pix-sheet-close:hover {
    background: #d92c52;
  }

  /* CSS para seção PIX inline */
  .pix-section {
    background: transparent;
    padding: 0;
    margin: 0;
    box-shadow: none;
  }
  
  .pix-container {
    max-width: 100%;
  }
  
  .pix-qrcode-container {
    text-align: center;
    margin: 24px 0;
  }
  
  .pix-qrcode {
    background: white;
    padding: 18px;
    border-radius: 20px;
    border: 1px solid rgba(15, 23, 42, 0.08);
    display: inline-flex;
    box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
  }
  
  .pix-codigo-container {
    margin: 24px 0;
  }
  
  .pix-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #0f172a;
    font-size: 0.95rem;
  }
  
  .pix-input-group {
    display: flex;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
    background: #ffffff;
    border: 1px solid rgba(15, 23, 42, 0.08);
  }
  
  .pix-codigo-input {
    flex: 1;
    padding: 16px;
    border: none;
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    background: #ffffff;
    color: #0f172a;
    letter-spacing: 0.03em;
    min-height: 56px;
  }
  
  .pix-copiar-btn {
    padding: 0 18px;
    background: #ef3e64;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.95rem;
    transition: background 0.25s ease, transform 0.2s ease;
    min-width: 120px;
  }
  
  .pix-copiar-btn:hover {
    background: #d92c52;
    transform: translateY(-1px);
  }
  
  .pix-footer {
    text-align: center;
    color: #6c757d;
    margin-top: 25px;
    padding-top: 20px;
    border-top: 2px solid #eee;
    font-size: 1.1em;
  }
  .pix-footer {
    display: none;
  }
  
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(48px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
  
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @media (max-width: 600px) {
    .pix-section {
      margin: 10px;
      padding: 15px;
    }
    
    .pix-container {
      padding: 10px;
    }
    
    .pix-codigo-input {
      font-size: 0.9rem;
      padding: 14px;
    }
    
    .pix-copiar-btn {
      padding: 14px 16px;
      font-size: 0.9rem;
    }
    
    .pix-qrcode {
      padding: 15px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
    }
    
    .pix-sheet {
      border-radius: 24px;
    }
  }
</style>

</body>
</html>
